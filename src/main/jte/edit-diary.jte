@param com.shevchenko.mentalHealthSupport.models.User currentUser
@param com.shevchenko.mentalHealthSupport.models.Diary diaryEntry
@param java.time.format.DateTimeFormatter formatter
@param org.springframework.security.web.csrf.CsrfToken _csrf
@param boolean isLoggedIn

@template.layout(
title = "–û—Å–æ–±–∏—Å—Ç–∏–π —â–æ–¥–µ–Ω–Ω–∏–∫",
description = "–í–∞—à –æ—Å–æ–±–∏—Å—Ç–∏–π —â–æ–¥–µ–Ω–Ω–∏–∫ –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –µ–º–æ—Ü—ñ–π–Ω–æ–≥–æ —Å—Ç–∞–Ω—É",
showHero = false,
content = @`
    @if (currentUser == null || diaryEntry == null)
        <div class="diary-container">
            <h1 class="diary-title">–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Å—É —â–æ–¥–µ–Ω–Ω–∏–∫–∞</h1>
            <p class="diary-description">–í–Ω–µ—Å—ñ—Ç—å –∑–º—ñ–Ω–∏ —É —Å–≤—ñ–π –∑–∞–ø–∏—Å —Ç–∞ –∑–±–µ—Ä–µ–∂—ñ—Ç—å –æ–Ω–æ–≤–ª–µ–Ω—É –≤–µ—Ä—Å—ñ—é.</p>

            @if(currentUser == null)
                <div class="auth-prompt">
                    <p>–î–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —â–æ–¥–µ–Ω–Ω–∏–∫–∞ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ <a href="/login?redirect=/diary">—É–≤—ñ–π—Ç–∏</a> –≤ —Å–∏—Å—Ç–µ–º—É –∞–±–æ <a href="/register">–∑–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—å</a>.</p>
                </div>
            @else
                <div class="not-found-prompt">
                    <p>–ó–∞–ø–∏—Å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∞–±–æ —É –≤–∞—Å –Ω–µ–º–∞—î –¥–æ—Å—Ç—É–ø—É –¥–æ —Ü—å–æ–≥–æ –∑–∞–ø–∏—Å—É.</p>
                    <a href="/diary" class="btn">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ —â–æ–¥–µ–Ω–Ω–∏–∫–∞</a>
                </div>
            @endif
        </div>
    @else
        <div class="diary-container">
            <h1 class="diary-title">–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Å—É —â–æ–¥–µ–Ω–Ω–∏–∫–∞</h1>
            <p class="diary-description">–í–Ω–µ—Å—ñ—Ç—å –∑–º—ñ–Ω–∏ —É —Å–≤—ñ–π –∑–∞–ø–∏—Å —Ç–∞ –∑–±–µ—Ä–µ–∂—ñ—Ç—å –æ–Ω–æ–≤–ª–µ–Ω—É –≤–µ—Ä—Å—ñ—é.</p>

            <div class="diary-edit-form">
                <form action="/diary/edit/${diaryEntry.getId()}" method="post" class="emotion-form">
                    <input type="hidden" name="${_csrf.getParameterName()}" value="${_csrf.getToken()}"/>
                    <div class="mood-selector">
                        <label>
                            <input type="radio" name="mood" value="great">
                            <span class="mood-emoji">üòÑ</span>
                            <span class="mood-text">–ß—É–¥–æ–≤–æ</span>
                        </label>
                        <label>
                            <input type="radio" name="mood" value="good">
                            <span class="mood-emoji">üôÇ</span>
                            <span class="mood-text">–î–æ–±—Ä–µ</span>
                        </label>
                        <label>
                            <input type="radio" name="mood" value="neutral">
                            <span class="mood-emoji">üòê</span>
                            <span class="mood-text">–ù–æ—Ä–º–∞–ª—å–Ω–æ</span>
                        </label>
                        <label>
                            <input type="radio" name="mood" value="bad">
                            <span class="mood-emoji">üòî</span>
                            <span class="mood-text">–ü–æ–≥–∞–Ω–æ</span>
                        </label>
                        <label>
                            <input type="radio" name="mood" value="awful">
                            <span class="mood-emoji">üòû</span>
                            <span class="mood-text">–î—É–∂–µ –ø–æ–≥–∞–Ω–æ</span>
                        </label>
                    </div>

                    <div class="diary-input">
                        <label for="diaryText">–ó–º—ñ—Å—Ç –∑–∞–ø–∏—Å—É:</label>
                        <textarea id="diaryText" name="content" rows="5" placeholder="–©–æ –≤–∏ –≤—ñ–¥—á—É–≤–∞—î—Ç–µ? –©–æ —Å—Ç–∞–ª–æ—Å—è —Å—å–æ–≥–æ–¥–Ω—ñ?">${diaryEntry.getContent()}</textarea>

                        <div class="tags-selector">
                            <label>–í–∏–±–µ—Ä—ñ—Ç—å —Ç–µ–≥–∏:</label>
                            <div class="tags-options">
                                <label><input type="checkbox" name="tags" value="anxiety"> –¢—Ä–∏–≤–æ–≥–∞</label>
                                <label><input type="checkbox" name="tags" value="happiness"> –†–∞–¥—ñ—Å—Ç—å</label>
                                <label><input type="checkbox" name="tags" value="stress"> –°—Ç—Ä–µ—Å</label>
                                <label><input type="checkbox" name="tags" value="relaxation"> –†–æ–∑—Å–ª–∞–±–ª–µ–Ω–Ω—è</label>
                                <label><input type="checkbox" name="tags" value="anger"> –ì–Ω—ñ–≤</label>
                                <label><input type="checkbox" name="tags" value="meditation"> –ú–µ–¥–∏—Ç–∞—Ü—ñ—è</label>
                            </div>
                        </div>

                        <div class="privacy-option">
                            <label>
                                <input type="checkbox" name="isPrivate" value="true" checked>
                                –ü—Ä–∏–≤–∞—Ç–Ω–∏–π –∑–∞–ø–∏—Å (–≤–∏–¥–Ω–æ —Ç—ñ–ª—å–∫–∏ –≤–∞–º)
                            </label>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn diary-submit">–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏</button>
                            <a href="/diary" class="btn btn-secondary">–°–∫–∞—Å—É–≤–∞—Ç–∏</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    @endif
    `,
isLoggedIn = isLoggedIn,
_csrf = _csrf
)
<style>
    .diary-container {
        background-color: white;
        border-radius: 8px;
        padding: 2rem;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .diary-title {
        color: var(--primary);
        margin-bottom: 1rem;
        font-size: 2rem;
    }

    .diary-description {
        color: #666;
        margin-bottom: 2rem;
    }

    .auth-prompt {
        background-color: var(--light);
        padding: 2rem;
        border-radius: 8px;
        text-align: center;
        margin: 2rem 0;
    }

    .auth-prompt a {
        color: var(--primary);
        font-weight: bold;
        text-decoration: none;
    }

    .diary-emotions {
        margin-bottom: 2rem;
    }

    .mood-selector {
        display: flex;
        justify-content: space-between;
        margin: 1.5rem 0;
        flex-wrap: wrap;
    }

    .mood-selector label {
        display: flex;
        flex-direction: column;
        align-items: center;
        cursor: pointer;
        padding: 1rem;
        border-radius: 8px;
        transition: background-color 0.3s;
    }

    .mood-selector label:hover {
        background-color: #f0f0f0;
    }

    .mood-selector input[type="radio"] {
        display: none;
    }

    .mood-selector input[type="radio"]:checked + .mood-emoji {
        transform: scale(1.2);
    }

    .mood-emoji {
        font-size: 2rem;
        margin-bottom: 0.5rem;
        transition: transform 0.3s;
    }

    .mood-text {
        font-size: 0.9rem;
    }

    .diary-input {
        background-color: var(--light);
        padding: 1.5rem;
        border-radius: 8px;
    }

    .diary-input label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: bold;
    }

    .diary-input textarea {
        width: 100%;
        padding: 1rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        resize: vertical;
        margin-bottom: 1rem;
        font-size: 1rem;
    }

    .tags-selector {
        margin: 1rem 0;
    }

    .tags-options {
        display: flex;
        flex-wrap: wrap;
        gap: 0.8rem;
        margin-top: 0.5rem;
    }

    .tags-options label {
        font-weight: normal;
        display: flex;
        align-items: center;
        gap: 0.3rem;
    }

    .privacy-option {
        margin: 1rem 0;
    }

    .diary-submit {
        background-color: var(--primary);
        margin-top: 1rem;
        border: none;
        cursor: pointer;
        font-size: 1rem;
    }

    .diary-submit:hover {
        background-color: var(--secondary);
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –±—É–ª–∞ –æ–±—Ä–∞–Ω–∞ —Ö–æ—á–∞ –± –æ–¥–Ω–∞ –æ–ø—Ü—ñ—è –Ω–∞—Å—Ç—Ä–æ—é
        const moodOptions = document.querySelectorAll('input[name="mood"]');
        let anyChecked = Array.from(moodOptions).some(option => option.checked);

        // –Ø–∫—â–æ –∂–æ–¥–Ω–∞ –æ–ø—Ü—ñ—è –Ω–µ –æ–±—Ä–∞–Ω–∞, –æ–±–∏—Ä–∞—î–º–æ "–ù–æ—Ä–º–∞–ª—å–Ω–æ" –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
        if (!anyChecked) {
            const neutralOption = document.querySelector('input[name="mood"][value="neutral"]');
            if (neutralOption) {
                neutralOption.checked = true;
            }
        }
    });
</script>